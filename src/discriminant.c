/* ************************************************************************** */
/*                                                                            */
/*                                                        ::::::::            */
/*   discriminant.c                                     :+:    :+:            */
/*                                                     +:+                    */
/*   By: mmosk <mmosk@student.codam.nl>               +#+                     */
/*                                                   +#+                      */
/*   Created: 2024/01/31 13:50:28 by mmosk         #+#    #+#                 */
/*   Updated: 2024/02/08 12:35:59 by mmosk         ########   odam.nl         */
/*                                                                            */
/* ************************************************************************** */

#include "push_swap.h"

//Discriminant specifications:
//--

//Variable base for the discriminant.
//For this grid:
//Y is the value of the previous digit in the discriminant.
//X is the current value of the current digit in the discriminant.
//Stored value is the next value of the current digit in the discriminant.
//0x0 should not appear, 0xF means the digit has reached the end of its base
//and should increment the previous digit.
//I shan't be held accountable for any optometric costs you incur in trying to
//read it.
static const unsigned char	g_crazebase[16][16]
	= {
{0x1, 0x2, 0x3, 0x4, 0x5, 0x6, 0x7, 0x8, 0x9, 0xA, 0xE, 0x0, 0x0, 0x0, 0xF},
{0x1, 0x2, 0x3, 0x4, 0x5, 0x6, 0x7, 0x8, 0x9, 0xA, 0xF},
{0x1, 0x5, 0x0, 0x0, 0x0, 0x6, 0x7, 0x8, 0x9, 0xA, 0xE, 0x0, 0x0, 0x0, 0xF},
{0x1, 0x5, 0x0, 0x0, 0x0, 0x6, 0x7, 0x8, 0x9, 0xA, 0xE, 0x0, 0x0, 0x0, 0xF},
{0x1, 0x5, 0x0, 0x0, 0x0, 0x6, 0x7, 0x8, 0x9, 0xA, 0xE, 0x0, 0x0, 0x0, 0xF},
{0x1, 0x2, 0x3, 0x4, 0x5, 0x9, 0x0, 0x0, 0x0, 0xE, 0x0, 0x0, 0x0, 0x0, 0xF},
{0x1, 0x2, 0x3, 0x4, 0x6, 0x0, 0xA, 0x0, 0x0, 0x0, 0xE, 0x0, 0x0, 0x0, 0xF},
{0x1, 0x2, 0x3, 0x4, 0x5, 0x6, 0x7, 0xE, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xF},
{0x1, 0x2, 0x3, 0x4, 0x8, 0x0, 0x0, 0x0, 0x9, 0xA, 0xE, 0x0, 0x0, 0x0, 0xF},
{0x1, 0x2, 0x3, 0x4, 0x5, 0x9, 0x0, 0x0, 0x0, 0xE, 0x0, 0x0, 0x0, 0x0, 0xF},
{0x1, 0x2, 0x3, 0x4, 0x6, 0x0, 0xA, 0x0, 0x0, 0x0, 0xE, 0x0, 0x0, 0x0, 0xF},
{0x0},
{0x0},
{0x0},
{0x2, 0x0, 0x3, 0x4, 0x5, 0x6, 0x7, 0x8, 0x9, 0xA, 0xE, 0x0, 0x0, 0x0, 0xF},
{0xF}
};

//You made it through!
//You may now laugh, scream, or turn into a murder of crows and peck my eyes out

static inline unsigned char	deref_crazebase(t_ulong dsc)
{
	return (g_crazebase[dsc >> DSC_SIZE & DSC_LAST][dsc & DSC_LAST]);
}

//ft_printf("__-Current: %X\n--_Cut: %X\n", (unsigned long)current, 
//(discriminant & DSC_BODY));

t_ulong	iter_dsc(t_ulong discriminant)
{
	unsigned char	current;

	current = deref_crazebase(discriminant);
	if (current == 0xF)
	{
		if ((discriminant >> DSC_SIZE & DSC_LAST) == 0x0)
			return (DSC_END);
		discriminant = iter_dsc(discriminant >> DSC_SIZE) << DSC_SIZE;
		current = deref_crazebase(discriminant);
	}
	discriminant = (discriminant & DSC_BODY) | current;
	return (discriminant);
}

t_ulong	mk_dsc(t_uint depth)
{
	t_ulong out;

	out = 0;
	while (depth--)
	{
		out <<= DSC_SIZE;
		out |= 0x1;
	}
	return (out);
}
